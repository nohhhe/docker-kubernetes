아이템 5.매니페스트 파일(정의 파일) 작성
=========================
## ⭕ 매니페스트 파일이란?
쿠버네티스는 매니페이스트 파일(정의 파일)에 기재된 내용에 따라 파드를 생성한다. 매니페스트 파일의 내용을 쿠버네티스에 업로드하면 그 내용이 데이터베이스(etcd)에 '바람직한 상태'로 등록되며 서버 환경을 이 상태로 유지한다.

#### ✦ 바람직한 상태란?
바람직한 상태란 매니페스트에 기재된 내용으로 상태가 유지되는 것을 말한다. 쿠버네티스가 데이터베이스(etcd)에 저장하고 이를 클러스터가 유지하도록 지속적으로 현재 상태와 비교하며 유지시킨다.

##### 바람직한 상태를 유지시키는 것을 테스트 해보기
1. 현재 상태 확인
> kubectl get pods
2. Pod 삭제
> kubectl delete pod [파드 이름]
3. 바람직한 상태 복구 확인 (Deployment 리소스의 상세 정보를 확인)
> kubectl describe deployment apa000dep


### ◉ YAML 형식으로 매니페스트 파일 작성
파드나 서비스에 대한 설정을 쿠버네티스트에서는 매니페스트라고 한다. 매니페스트 파일은 YAML 또는 JSON 형식으로 기재한다.

### ◉ 매니페스트 파일은 리소스 단위로 작성한다.
매니페스트 파일은 리소스 단위로 작성한다. 리소스는 파드나 서비스, 드플로이먼트, 레플리카 세트 등을 가리킨다. 초보자 수준에서 다루게 될 리소스는 서비스나 디플로이먼트 정도다.
왜냐하면 디플로이먼트 항목에 레플리카세트와 파드가 포함돼 있기 때문이다.

### ◉ 매니페스트 파일은 여러 파일로 분할할 수 있다.
매니페스트 파일은 리소스 단위로 분할해 작성해도 되고 한 파일에 합쳐 작성해도 된다. 한 파일로 작성할 때는 각 리소스를 '---'로 구분한다.
리소스 단위로 파일을 나눌때는 각 리소스를 구별할 수 있도록 이름을 붙인다.

## ⭕ 매니페스트 파일로 작성할 내용
### ◉ 리소스 설정(API 그룹 및 유형)
리소스를 정의하려면 먼저 API 그룹과 리소스 유형을 지정해야 한다.

### ◉ 메타데이터와 스펙
매니페스트 파일에는 메타데이터와 스펙을 기재한다.

메타데이터에는 리소스의 이름이나 레이블을 기재한다. 초보자 수준에서는 name과 label 항목만 이해하면 된다.

스펙은 리소스의 내용을 정의한다. 요약하자면 '어떤 리소스를 만들 것인가'에 해당하는 부분이다.

#### ✦ 주요 메타데이터
| 항목                | 내용 |
|-------------------|----|
| name              | 리소스의 이름 |
| namespace         | 리소스를 세분화한 DNS 호환 레이블 |
| uid               | 유일 식별자 |
| resourceVersion   | 리소스의 버전 |
| generation        | 생성 순서를 나타내는 번호 |
| creationTimestamp | 리소스 생성 시간 |
| deletionTimestamp | 리소스 삭제 시간 |
| labels            | 임의의 레이블 |
| annotations       | 리소스에 설정할 값, 선택 대상은 되지 못한다. |

❗️anotation이 아니라 annotations인듯?

### ◉ 레이블과 셀렉터
파드나 서비스 같은 리소스에 원하는 레이블을 붙일 수 있다. 레이블은 키-값 쌍의 형태로 메타데이터로 설정한다.
레이블을 부여하면 셀렉터 기능을 사용해 특정 레이블이 부여된 파드만을 배포하는 등 특정 파드를 선택해 설정할 수 있따.

## ⭕ 메타데이터와 스펙 작성 - 파드
파드는 중항목이 세 개다. 메타데이터 아래로 name과 labels, 스펙 아래의 containers에 컨테이너 구성을 기재한다. 원래 volumes 항목도 있지만 작성하지 않는 경우도 많다. 그리고 contauners 항목 아래에 소항목 name, image, ports가 포함된다.

여기서 주의할 점은 name이다. containers 항목에서 지정한 이름은 컨테이너의 이름이다. 그 위에 있는 metadata 아래의 name은 파드의 이름이다.

### ◉ 파드의 작성 항목
<img src="../../resources/images/파드의 작성 항목.jpg" alt="파드의 작성 항목" style="width: 100%; height: auto;" />

## ⭕ 메타데이터와 스펙 작성 - 디플로이먼트
### ◉ 셀렉터의 설정
디플로이먼트가 특정한 레이블이 부여된 파드를 관리할 수 있도록 하는 설정이다. 'matchLabels:' 뒤로 레이블을 기재한다. 대신 'matchExpressions:'를 사용할 수도 있다.

❗️ 사실상 matchExpressions이게 아닌 matchLabels 이거는 서비스랑 동일하게 명시적으로 사용하는 것이다.

### ◉ 레플리카의 설정
파드의 레플리카에 대한 관리다. 파드 수를 몇개로 유지할 것인지 설정한다. 이 값을 0으로 설정하면 파드가 사라진다.

### ◉ 템플릿 작성
생성할 파드의 정보를 여기에 기재한다. 기재 내용은 파드에 기재된 내용과 거의 같다.

#### ✦ 셀렉터: matchLabels의 수수께기
디플로이먼트는 셀렉터를 설정하면 '레이블셀렉터'를 사용하며, 이 조건에 부합할 때와 같은 설정이 가능하지만 서비스는 리소스를 직접 지정하기 때문에 해당 레이블을 그대로 기재해야 한다.

### 디플로이먼트의 작성 항목
<img src="../../resources/images/디플로이먼트의 작성 항목.jpg" alt="디플로이먼트의 작성 항목" style="width: 100%; height: auto;" />

## ⭕ 메타데이터와 스펙 작성 - 서비스
서비스의 역할은 파드로 들어오는 요청을 관리하는 것이므로 설정 내용도 통신과 관련된 것이다.

### ◉ 유형 설정
유형은 서비스의 종류를 말한다. 외부로부터 서비스에 어떤 유형의 IP 주소(또는 DNS)로 접근할지를 설정한다.

| 유형 이름 | 내용                                   |
|---------|--------------------------------------|
| ClusterIP | 클러스터IP를 통해 서비스에 접근하도록 함(외부에서는 접근 불가) |
| NodePort | 워커 노드의 IP를 통해 서비스에 접근하도록 함           |
| LoadBalancer | 로드밸런서의 IP를 통해 서비스에 접근하도록 함           |
| ExternalName | 파드에서 서비스를 통해 외부로 나가기 위한 설정 |

실무에서는 LoadBalancer를 사용하는 경우가 대부분이다.

### ◉ 포트 설정
port는 서비스, nodePort는 워커 노드, targetProt는 컨테이너의 포트를 각각 설정한다. nodePort에는 30000~32767 사이의 숫자를 설정할 수 있다.

| 항목 | 내용        |
|----|-----------|
| port | 서비스 포트    |
| nodePort | 워커 노드의 포트 |
| targetPort | 컨테이너 포트   |

### ◉ 셀렉터 설정
서비스가 특정 레이블의 부여된파드를 선택적으로 관리하기 위한 설정이다. 서비스에서는 'matchLabels:'를 사용해서는 안 된다.

---

### 📌스터디 내용
