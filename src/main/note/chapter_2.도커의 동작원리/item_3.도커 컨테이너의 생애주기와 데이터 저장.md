아이템 3.도커 컨테이너의 생애주기와 데이터 저장
=========================
## ⭕ 도커 컨테이너는 쓰고 버리는 일회용품
컨테이너에 대한 설명을 듣다 보면 '컨테이너의 수명' 또는 '컨테이너의 생애주기'라는 이야기가 반드시 나오게 된다.

컨테이너는 쉽게 만들 수 있다. 그러므로 컨테이너 하나를 업데이트하면서 계속 사용하기보다는 업데이트된 소프트웨어가 들어있는 새로운 컨테이너를 사용하는 것이 좋다.

초기 구축은 간단히 마쳤는데 유지 보수할 때마다 컨테이너를 일일이 업데이트하려니 컨테이너의 장점이 반감된다.

컨테이너를 만들고, 실행하고, 종료하고, 폐기하고, 새 컨테이너를 만드는 일련의 과정을 컨테이너의 생애주기라고 부른다.

#### ✦ 컨테이너의 수명
* 짧은 수명: 특정 작업(배치, 테스트)을 위해 짧은 시간 동안 실행된 후 종료되는 컨테이너
* 긴 수명: 웹 서버나 데이터베이스와 같이 지속적으로 서비스해야 하는 애플리케이션 컨테이너

#### ✦ 컨테이너 업데이트 방법
* 기존 컨테이너를 업데이트 하고 새로운 이미지를 만들어 다른 컨테이너에 배포하는 방식
  * 방법: 컨테이너 내부에서 소프트웨어나 설정을 업데이트하고, docker commit 명령을 사용해 새로운 이미지를 생성. 이 이미지를 이용해 새 컨테이너를 만들거나 배포.
  * 장점
    * 이미 실행 중인 컨테이너를 그대로 유지하면서 바로 업데이트 가능, 빠른 수정 및 이미지 생성 가능
  * 단점
    * 불투명성: 컨테이너 내부에서 어떤 변경이 이루어졌는지 명확하게 추적하기 어렵고, 버전 관리가 힘들어짐
    * Best Practice 위반: 컨테이너는 불변성을 유지하는 것이 원칙, 유지보수의 복잡성을 높일 수 있음
    * 낮은 확장성: 여러 서버에 배포하거나 확장하는데 있어서 자동화가 어려움
* 컨테이너 교체 방식(컨테이너 생애주기에 맞춰 동작하는 방식)
  * 방법: 소스 코드나 설정 파일이 업데이트되면, 이를 기준으로 새로운 이미지를 빌드(Dockerfile 사용). 기존 컨테이너를 삭제하고, 새로운 이미지로 새 컨테이너를 생성.
  * 장점
    * 불변 인프라: 이미지를 기준으로 새 컨테이너를 만들기 때문에 어떤 상태에서 생성된 것인지 명확하고 일관성 있게 관리 가능
    * 자동화 및 확장성: Docker Compose나 Kubernetes와 같은 도구를 이용해 이미지 빌드부터 배포까지 자동화 가능
    * 버전 관리: 이미지에 태그를 붙여 버전을 관리하고 롤백이 간편함
  * 단점
    * 초기 설정은 조금 더 복잡할 수 있음. 그러나 자동화가 되어 있으면 유지보수가 오히려 쉬움

#### ✦ 도커 파일
도커 이미지를 만들기 위한 설정 파일로, 이미지의 구성 요소와 실행 방법을 명시하는 데 사용
* 주요 내용
  * 구성 명세: 운영 체제, 소프트웨어 설치, 환경 변수 설정, 애플리케이션 실행 방법 등을 지정
  * 재현 가능성: 동일한 환경을 쉽게 재현할 수 있어, 개발 및 운영 환경 간의 일관성을 유지 가능
  * 자동화: 이미지 생성 과정을 자동화할 수 있어, 수동으로 이미지를 생성하는 것보다 효율적

#### ✦ 도커 이미지 만드는 방법
* Dockerfile 사용하기
  * 설명: 도커파일을 작성하여 필요한 소프트웨어와 설정을 정의하고, docker build 명령어로 이미지를 생성
  * 장점: 일관된 이미지 생성을 위한 표준화된 방법으로, 버전 관리가 용이
* 기존 컨테이너에서 커밋하기
  * 설명: 실행 중인 컨테이너의 상태를 새로운 이미지로 커밋. docker commit <container_id> <image_name> 명령을 사용 
  * 장점: 현재 상태를 그대로 이미지로 저장하여 재사용 가능
* Base 이미지 사용하기 
  * 설명: Docker Hub 등에서 기존의 베이스 이미지를 가져와 필요한 소프트웨어를 추가하여 새로운 이미지 생성 
  * 장점: 안정성이 높고 구축 시간이 단축

---

## ⭕ 데이터 저장
도커가 설치된 물리적 서버(호스트)의 디스크를 마운트해 이 디스크에 저장한다.
이런 방법으로 컨테이너가 폐기되더라도 데이터는 컨테이너 외부에 안전하게 저장되어 사라지지 않는다.
그리고 데이터를 이렇게 외부에 저장하면 다른 컨테이너와 데이터를 공유할 수도 있어서 매우 편리하다.
